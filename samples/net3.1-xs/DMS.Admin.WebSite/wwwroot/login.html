<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE">
    <title>DMS--登录</title>
    <meta name="description" content="">
    <meta name="keywords" content="">
    <link rel="icon" type="image/x-icon" href="/img/ccdfs.ico" />
    <link href="/css/login.css" rel="stylesheet">
    <script src="/js/public/jquery-1.11.1.js"></script>
    <script src="/js/plugins/jquery.cookie.js"></script>
    <script src="/js/public/tools.js"></script>
    <script src="/js/public/html5shiv.js"></script>
    <script src="/js/public/md5.js"></script>
</head>
<body>
    <div class="loginBox">
        <div class="logo"><img src="/img/ccdfs.png"></div>
        <div class="loginBoxForm">
            <form id="targetForm">
                <table cellpadding="0" cellspacing="0" width="100%">
                    <tbody>
                        <tr>
                            <td width="80">
                                用户名：
                            </td>
                            <td>
                                <input name="UserName" type="text" id="txtUserName" class="txt" test="required">
                            </td>
                        </tr>
                        <tr>
                            <td width="80">
                                密&nbsp;&nbsp;&nbsp;&nbsp;码：
                            </td>
                            <td>
                                <input name="UserPassword" type="password" id="txtUserPassword" class="txt" test="required">
                            </td>
                        </tr>
                        <tr id="trValidcode" style="display: none;">
                            <td width="80">
                                验证码：
                            </td>
                            <td>
                                <input name="checkCode" type="text" style="width:60px;" id="txtcheckCode" class="txt txtcode">
                                <!--<img style="cursor: pointer;" alt="点击刷新验证码" id="imgValidateCode" src="/Images/loader.gif">-->
                            </td>
                        </tr>
                        <tr>
                            <td width="80">
                                &nbsp;
                            </td>
                            <td>
                                <input type="submit" value="登录" class="btn">
                            </td>
                        </tr>
                    </tbody>
                </table>
            </form>
        </div>
        <p class="notice">DMS有限公司版权所有 2012-2015</p>
    </div>
    <script type="text/javascript">
        $(function () {
            T.registerFileds();
            $("#targetForm").submit(function () {
                var entity = T.formToJSON("#targetForm", function (data) {
                    data["UserPassword"] = hex_md5(data["UserPassword"]);
                    return data;
                });
                if (entity) {
                    $.ajax({
                        type: "POST",
                        url: "api/Login/DoLogin",
                        contentType: "application/json",
                        data: JSON.stringify(entity),
                        xhrFields: {
                            withCredentials: true
                        },
                        success: function (res) {
                            if (res.errno == 0) {
                                T.alert("登录成功", 1000, function () {
                                    window.location = T.DOMAIN.WWW + "index.html";
                                });
                                //T.cookie("__asid", res.data.Sid, 7);
                            } else {
                                T.alert(res.errmsg);
                            }
                        },
                        error: function (err) {
                            T.alert("异常！" + err.status + "（" + err.statusText + "）");
                        }
                    });
                }
                return false;
            });
        });
    </script>
</body>
</html>